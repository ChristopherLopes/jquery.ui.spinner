(function(a){a.widget("ui.spinbuttons",{_init:function(){var e=this,d=e.element;if((d.get(0).tagName!="INPUT")||(d.attr("type")!="text")){console.error("Invalid target for ui.spinbuttons");return}var g=e._getData("min"),b=e._getData("max"),f=d.get(0).maxLength;if(g&&b&&g>b){e._setData("min",g=b)}if(f){var c=Math.pow(10,f)-1;if((b==null)||(b>c)){e._setData("max",c)}c=-(c+1)/10+1;if((g==null)||(g<c)){e._setData("min",c)}}e._createButtons(d);e._change();if(d.get(0).disabled){e.disable()}},_createButtons:function(c){function I(R){return R=="auto"?0:parseInt(R)}var h=this,v=h.options,M=v.className,t=v.width,g=a.support.boxModel,b=c.outerHeight(),z=I(c.css("margin-right")),u=h.wrapper=c.css({width:(g?c.width():c.outerWidth())-t,marginRight:z+t,textAlign:"right"}).after('<span class="ui-spinbuttons ui-widget"></span>').next(),q=h.btnContainer=a('<div class="ui-spinbuttons-buttons"><div class="ui-spinbuttons-up ui-spinbuttons-button ui-state-default ui-corner-tr"><span class="ui-icon ui-icon-triangle-1-n">&nbsp;</span></div><div class="ui-spinbuttons-down ui-spinbuttons-button ui-state-default ui-corner-br"><span class="ui-icon ui-icon-triangle-1-s">&nbsp;</span></div></div>'),p,w,E,A,x=false,f=false,D=false,n=false,L="ui-state-active",o="ui-state-hover",F=a.ui.keyCode.UP,j=a.ui.keyCode.DOWN,P=a.ui.keyCode.PAGE_UP,C=a.ui.keyCode.PAGE_DOWN,d=a.browser.msie;if(M){u.addClass(M)}u.append(q.css({height:b,left:-t-z,top:(c.offset().top-u.offset().top+(a.browser.msie?0:0))+"px"}));var B=h.buttons=q.find(".ui-spinbuttons-button");B.css({width:t-(g?B.outerWidth()-B.width():0),height:b/2-(g?B.outerHeight()-B.height():0)});var Q=B.find(".ui-icon");Q.css({marginLeft:(B.innerWidth()-Q.width())/2,marginTop:(B.innerHeight()-Q.height())/2});q.width(B.outerWidth());var J=h._getData("showOn");if(J=="focus"||J=="both"){c.focus(K).blur(r)}if(J=="hover"||J=="both"){B.hover(y,N);c.hover(y,N)}if(J!="always"){q.css("opacity",0)}B.hover(k,H).mousedown(i).mouseup(e).mouseout(e);if(d){B.dblclick(l).bind("selectstart",function(){return false})}p=a(B.get(0));w=a(B.get(1));c.keydown(s).keyup(m).change(function(){h._change()}).focus(function(){d?O():setTimeout(O,0)});function O(){h.element.select()}function s(T){var R,S;switch(T.keyCode){case F:case P:R=1;S=T.keyCode==P;break;case j:case C:R=-1;S=T.keyCode==C}if(R){if(!D&&!h._getData("disabled")){h._change();(R>0?p:w).addClass(L);h._doSpin(R,S);h.spinCount=1;h.inSpinTwo=false;D=true;h._setTimer(h._spin,v.spinDelayOne,R,S)}return false}}function m(R){switch(R.keyCode){case F:case P:p.removeClass(L);h._clearTimer();D=false;return false;case j:case C:w.removeClass(L);h._clearTimer();D=false;return false}}function G(S){if(E){if(S==A){return}clearInterval(E)}A=S;E=setInterval(R,100);function R(){clearInterval(E);E=null;S()}}function y(){G(function(){x=true;if(!f){h.showButtons()}})}function N(){G(function(){x=false;if(!f){h.hideButtons()}})}function K(){f=true;if(!x){h.showButtons()}}function r(){f=false;if(!x){h.hideButtons()}}function l(){if(!v.disabled){h._change();h._doSpin(this===p.get(0)?1:-1)}return false}function i(){if(!v.disabled){h._change();var R=h.element.get(0),S=this===p.get(0)?1:-1;R.focus();R.select();a(this).addClass(L);h.element.focus();h._doSpin(S);h.spinCount=1;h.inSpinTwo=false;n=true;h._setTimer(h._spin,v.spinDelayOne,S)}return false}function e(){if(n){a(this).removeClass(L);h._clearTimer();n=false}return false}function k(){if(!h._getData("disabled")){a(this).addClass(o)}}function H(){if(!h._getData("disabled")){a(this).removeClass(o)}}},_spin:function(b,c){if(b>0){this.increment(c)}else{this.decrement(c)}this.spinCount++;if(!this.inSpinTwo){var d=this._getData("spinsBeforeDelayTwo");if(d&&this.spinCount>d){this.inSpinTwo=true;this._setTimer(this._spin,this._getData("spinDelayTwo"),b,c)}}},_setTimer:function(f,d){var c=Array.prototype.slice.call(arguments,2),b=this;b._clearTimer();b.timer=setInterval(e,d);function e(){f.apply(b,c)}},_clearTimer:function(){if(this.timer){clearInterval(this.timer);this.timer=null}},_doSpin:function(e,g){var i,d=this.options,h=this.value,f=d.min,c=d.max,b=(g?d.largeIncrement:d.increment)*e;if(h==null){i=(e>0?f||c:c||f)||0}else{i=h+b}if((c!=null)&&(i>c)){i=c}else{if((f!=null)&&(i<f)){i=f}}if(i!=h){this.value=i;this.element.val(i).change()}return false},increment:function(b){return this._doSpin(1,b)},decrement:function(b){return this._doSpin(-1,b)},showButtons:function(c){var b=this.btnContainer.stop();if(c){b.css("opacity",1)}else{b.fadeTo("fast",1)}},hideButtons:function(c){var b=this.btnContainer.stop();if(c){b.css("opacity",0)}else{b.fadeTo("fast",0)}this.buttons.removeClass("ui-state-hover")},setValue:function(b){this.value=b;this.element.val(!b?"":b)},getValue:function(){return this.value},_parseValue:function(){var b=this.element.val();return b?parseInt(b):null},_change:function(){var d=this._parseValue(),c=this._getData("min"),b=this._getData("max");if(isNaN(d)||((c!=null)&&(d<c))||((b!=null)&&(d>b))){d=this.value}this.element.val(d).get(0).focus();this.value=d},enable:function(){this.buttons.removeClass("ui-state-disabled");this.element.get(0).disabled=false;a.widget.prototype.enable.call(this)},disable:function(){this.buttons.addClass("ui-state-disabled");this.element.get(0).disabled=true;a.widget.prototype.disable.call(this)},destroy:function(b){this.wrapper.after(this.element).remove();a.widget.prototype.destroy.call(this)}});a.extend(a.ui.spinbuttons,{version:"1.0",getter:"getValue",defaults:{min:null,max:null,increment:1,largeIncrement:10,className:null,showOn:"always",width:16,spinDelayOne:500,spinDelayTwo:100,spinsBeforeDelayTwo:3}})})(jQuery);