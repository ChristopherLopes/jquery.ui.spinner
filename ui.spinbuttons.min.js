(function(a){a.widget("ui.spinbuttons",{_init:function(){var e=this,d=e.element,g=e._getData("min"),b=e._getData("max"),f=d.get(0).maxLength,c;if((d.get(0).tagName!="INPUT")||(d.attr("type")!="text")){console.error("Invalid target for ui.spinbuttons");return}if(g&&b&&g>b){e._setData("min",g=b)}if(f){c=Math.pow(10,f)-1;if((b==null)||(b>c)){e._setData("max",c)}c=-(c+1)/10+1;if((g==null)||(g<c)){e._setData("min",c)}}e._createButtons(d);e._change();if(d.get(0).disabled){e.disable()}},_createButtons:function(c){function M(Y){return Y=="auto"?0:parseInt(Y)}var i=this,z=i.options,S=z.className,x=z.width,h=a.support.boxModel,b=c.outerHeight(),D=M(c.css("margin-right")),y=i.wrapper=c.css({width:(h?c.width():c.outerWidth())-x,marginRight:D+x,textAlign:"right"}).after('<span class="ui-spinbuttons ui-widget"></span>').next(),t=i.btnContainer=a('<div class="ui-spinbuttons-buttons"><div class="ui-spinbuttons-up ui-spinbuttons-button ui-state-default ui-corner-tr"><span class="ui-icon ui-icon-triangle-1-n">&nbsp;</span></div><div class="ui-spinbuttons-down ui-spinbuttons-button ui-state-default ui-corner-br"><span class="ui-icon ui-icon-triangle-1-s">&nbsp;</span></div></div>'),s,A,I,E,B=false,g=false,H=false,q=false,F,X,N,U,P=c.get(0).dir=="rtl",R="ui-state-active",r="ui-state-hover",o=a.ui.keyCode,J=o.UP,l=o.DOWN,Q=o.RIGHT,f=o.LEFT,W=o.PAGE_UP,G=o.PAGE_DOWN,k=o.HOME,w=o.END,d=a.browser.msie;if(S){y.addClass(S)}y.append(t.css({height:b,left:-x-D,top:(c.offset().top-y.offset().top+(a.browser.msie?0:0))+"px"}));F=i.buttons=t.find(".ui-spinbuttons-button");F.css({width:x-(h?F.outerWidth()-F.width():0),height:b/2-(h?F.outerHeight()-F.height():0)});X=F.find(".ui-icon");X.css({marginLeft:(F.innerWidth()-X.width())/2,marginTop:(F.innerHeight()-X.height())/2});t.width(F.outerWidth());N=i._getData("showOn");if(N=="focus"||N=="both"){c.focus(O).blur(u)}if(N=="hover"||N=="both"){F.hover(C,T);c.hover(C,T)}if(N!="always"){t.css("opacity",0)}F.hover(m,L).mousedown(j).mouseup(e).mouseout(e);if(d){F.dblclick(n).bind("selectstart",function(){return false})}s=a(F.get(0));A=a(F.get(1));c.keydown(v).keyup(p).change(function(){i._change()}).focus(function(){d?V():setTimeout(V,0)});function V(){i.element.select()}function v(ab){var Z,aa,Y;if(U){return false}switch(ab.keyCode){case J:case W:Z=1;aa=ab.keyCode==W;break;case l:case G:Z=-1;aa=ab.keyCode==G;break;case Q:case f:Z=(ab.keyCode==Q)^P?1:-1;break;case k:Y=i._getData("min");if(Y!=null){i.setValue(Y)}return false;case w:Y=i._getData("max");if(Y!=null){i.setValue(Y)}return false}if(Z){if(!H&&!i._getData("disabled")){U=Z;i._change();(Z>0?s:A).addClass(R);i._doSpin(Z,aa);i.spinCount=1;i.inSpinTwo=false;H=true;i._setTimer(i._spin,z.spinDelayOne,Z,aa)}return false}}function p(Y){switch(Y.keyCode){case J:case Q:case W:case l:case f:case G:(U>0?s:A).removeClass(R);U=0;i._clearTimer();H=false;return false}}function K(Z){if(I){if(Z==E){return}clearInterval(I)}E=Z;I=setInterval(Y,100);function Y(){clearInterval(I);I=null;Z()}}function C(){K(function(){B=true;if(!g){i.showButtons()}})}function T(){K(function(){B=false;if(!g){i.hideButtons()}})}function O(){g=true;if(!B){i.showButtons()}}function u(){g=false;if(!B){i.hideButtons()}}function n(){if(!z.disabled){i._change();i._doSpin(this===s.get(0)?1:-1)}return false}function j(){if(!z.disabled){i._change();var Y=i.element.get(0),Z=this===s.get(0)?1:-1;Y.focus();Y.select();a(this).addClass(R);i.element.focus();i._doSpin(Z);i.spinCount=1;i.inSpinTwo=false;q=true;i._setTimer(i._spin,z.spinDelayOne,Z)}return false}function e(){if(q){a(this).removeClass(R);i._clearTimer();q=false}return false}function m(){if(!i._getData("disabled")){a(this).addClass(r)}}function L(){if(!i._getData("disabled")){a(this).removeClass(r)}}},_spin:function(b,c){if(b>0){this.increment(c)}else{this.decrement(c)}this.spinCount++;if(!this.inSpinTwo){var d=this._getData("spinsBeforeDelayTwo");if(d&&this.spinCount>d){this.inSpinTwo=true;this._setTimer(this._spin,this._getData("spinDelayTwo"),b,c)}}},_setTimer:function(f,d){var c=Array.prototype.slice.call(arguments,2),b=this;b._clearTimer();b.timer=setInterval(e,d);function e(){f.apply(b,c)}},_clearTimer:function(){if(this.timer){clearInterval(this.timer);this.timer=null}},_doSpin:function(e,g){var i,d=this.options,h=this.value,f=d.min,c=d.max,b=(g?d.largeIncrement:d.increment)*e;if(h==null){i=(e>0?f||c:c||f)||0}else{i=h+b}if((c!=null)&&(i>c)){i=c}else{if((f!=null)&&(i<f)){i=f}}if(i!=h){this.value=i;this.element.val(i).change()}return false},increment:function(b){return this._doSpin(1,b)},decrement:function(b){return this._doSpin(-1,b)},showButtons:function(c){var b=this.btnContainer.stop();if(c){b.css("opacity",1)}else{b.fadeTo("fast",1)}},hideButtons:function(c){var b=this.btnContainer.stop();if(c){b.css("opacity",0)}else{b.fadeTo("fast",0)}this.buttons.removeClass("ui-state-hover")},setValue:function(b){this.value=b;this.element.val(b!=null?b:"").change()},getValue:function(){return this.value},_parseValue:function(){var b=this.element.val();return b?parseInt(b):null},_change:function(){var d=this._parseValue(),c=this._getData("min"),b=this._getData("max");if(isNaN(d)||((c!=null)&&(d<c))||((b!=null)&&(d>b))){d=this.value}this.element.val(d).get(0).focus();this.value=d},enable:function(){this.buttons.removeClass("ui-state-disabled");this.element.get(0).disabled=false;a.widget.prototype.enable.call(this)},disable:function(){this.buttons.addClass("ui-state-disabled");this.element.get(0).disabled=true;a.widget.prototype.disable.call(this)},destroy:function(b){this.wrapper.after(this.element).remove();a.widget.prototype.destroy.call(this)}});a.extend(a.ui.spinbuttons,{version:"1.0",getter:"getValue",defaults:{min:null,max:null,increment:1,largeIncrement:10,className:null,showOn:"always",width:16,spinDelayOne:500,spinDelayTwo:100,spinsBeforeDelayTwo:3}})})(jQuery);